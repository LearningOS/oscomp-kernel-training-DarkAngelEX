# 虚拟文件系统

托尔斯泰说过：用户需要的文件系统都是相似的，而文件系统却各有各的不同。为了统一管理这些文件系统，linux使用虚拟文件系统来统一管理全部的文件系统。

# linux虚拟文件系统结构

虚拟文件系统只存在于内存中，在操作系统初始化时加载并在关机时消亡。

## 超级块

大多数磁盘文件系统都有超级块，而虚拟文件系统的超级块便是每个磁盘文件系统的抽象。

一个超级块只对应一个磁盘文件系统。

超级块包含一个根dentry作为根目录。

## inode文件节点

inode是文件系统中的元信息，管理一个打开的文件或目录。

一个文件只有一个inode，inode拥有打开的文件的所有权。

## dentry目录项

dentry保存了一个文件在目录树中的位置，并拥有一个inode的所有权。

每个打开的VFile都持有dentry的所有权，因此所有权路径为：

VFile -- dentry -- inode

# O(1)缓存块

总所周知，C++有Map，rust有BTreeMap，这些O(logn)容器看起来比愚蠢的O(N)链表快无数倍，但最终还是只能被linux的O(1)缓存块系统按在地上摩擦。

为什么链表这么快？链表不是需要遍历吗？

# 文件系统挂载

深入理解Linux文件系统之文件系统挂载(上) [https://zhuanlan.zhihu.com/p/378011720](https://zhuanlan.zhihu.com/p/378011720)

深入理解Linux文件系统之文件系统挂载(下) [https://zhuanlan.zhihu.com/p/378013367](https://zhuanlan.zhihu.com/p/378013367)

一篇搞懂Linux内核源码分析--虚拟文件系统(VFS) [https://zhuanlan.zhihu.com/p/472966478](https://zhuanlan.zhihu.com/p/472966478)

这一篇包含了linux上实现的数据结构

vfs dentry cache 模块实现分析 [https://zhuanlan.zhihu.com/p/457005511](https://zhuanlan.zhihu.com/p/457005511)

Linux的VFS实现 - 番外[一] - dcache [https://zhuanlan.zhihu.com/p/261669249](https://zhuanlan.zhihu.com/p/261669249)

linux文件系统

```
/bin：里边包含了一般程序工具，用户、管理员、系统都可以调用。/boot：系统启动文件和内核，在有些发行版中还包括grub，grub是一种通用的启动引导程序。/dev：系统设备文件目录，除cpu外的所有的硬件设备都会抽象成特殊的文件放在这里，虚拟设备也放在这里。/etc：包含了大部分重要的系统配置文件，这里文件的作用类似windows中的控制面板。/home：一般用户目录，一般一个用户对应一个目录，保存用户的数据。/lib、/lib64：库文件，包含了所有系统和用户需要的程序文件，64表示64位，但实际上除特殊的库，大部分还是链接到了lib目录下。/media：磁盘设备自动挂载的位置。按照用户分类，每一个用户目录下有其磁盘目录。/mnt：标准挂载点，可以挂载外设磁盘。/opt：一般存放第三方软件。/proc：包含系统资源信息的虚拟文件系统，提供了一个接触内核数据的接口，大部分是只读的，有些允许改变。系统运行时才有文件。/root：root用户的家目录。/sbin：系统和系统管理员用到的程序工具。/sys：与proc类似的虚拟文件系统，都是内核提供给用户的接口，可读可写。/tmp：系统使用的临时空间，重启后会清空。/usr：用于存放系统应用程序。/var：包含一些用户可变的或临时的文件，比如log文件、邮件队列、网络下载的临时文件等等。
```